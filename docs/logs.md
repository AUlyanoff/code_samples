# Требования к логированию действий компонентов проекта *****
Хотя не существует официального стандарта, общепринятое понятие о 
принципах логирования давно и устойчиво сформировано. Логирование в ***** 
будет следовать выработанным сообществом рекомендациям, не вводя новых.

> **Логирование предназначено для расследования случаев неправильного поведения программы 
в prodaction - окружении.**

Таким образом, логи (журналы событий) в первую очередь предназначены для разработчика, 
а Заказчик предоставляет их разработчику вместе с рекламацией. 

Еще одна вспомогательная, но важная задача логов - в простых случаях помочь 
администратору Заказчика понять типовые причины неработоспособности компонента 
без обращения в ПТП. Например, полнота настроек и их успешное применение: 
доступность сетевых ресурсов, наличие и актуальность сертификатов и подобное.

## Журналы логирования
### Размер
Логи записываются по принципу ротирования файлов. 
Размер и количество ротируемых файлов зависит от нагрузки на сервер (количества событий в единицу времени),
и подбирается опытным путём индивидуально для каждого Заказчика, исходя из минимально 
суточной нормы хранения событий.
* Размер лога от 64 Мб до 512 Мб
* Количество ротируемых файлов от 2 до 8.

Если максимального объема становится недостаточно, это указывает на ошибки в логировании.
В таком случае следует позаботиться о снижении частоты записей и повышении их информативности.
Процесс нахождение баланса между объемом и информативностью является творческим и 
возлагается на разработчика. Недопустимо формальное логирование, 
захламляющее журналы событий.

### Местоположение
Обычно логи записываются на стороне Заказчика. При необходимости их можно передать 
внешнему по отношению к Заказчику агрегатору по http. Требования для
такого случая установлены [здесь](.) в секции 
"Передача логов MDM-сервера на внешний агрегатор".

### Состав
Стандартными точками логирования являются вход и выход программного блока (печать
входных параметров и результатов). Конечно, помимо этого существует произвольное 
количество критических ветвлений и данных, требующих ситуативного логирования, 
в любых местах программы.

Одна запись в журнале (логе) должна содержать:
1. дату и время
2. идентификацию своего источника (файл, модуль, процедура, функция, строка...)
3. информативное диагностическое сообщение, ясно описывающее ситуацию
4. имена и значения переменных, полезных для анализа в данной ситуации
```angular2html
Примечание к п.3
    Не надо ограничиваться лаконичным сообщением "kit not found".
    Диагностическое сообщение не должно оставлять места для выяснения,
    при каких обстоятельствах не найден КИТ, и понятно описывать 
    эти обстоятельства.
    Например: "HTTP header 'X-MCC-ID' contains an empty string"
```


## Уровни логирования
Реализация должна содержать разумное подмножество следующего набора:
1. **debug** - подробная отладочная информация, раскрывающая детали происшедшего
2. **info** - любые интересные действия (напр., авторизация и выход пользователя)
3. **warning** - ситуации, тебующие внимания, но не являющиеся ошибками
4. **error** - ошибки, влияющие на бизнес-процесс (напр., отсутствие сертификата)
5. **fatal** - ошибки, влияющие на работоспособность программной системы 
(напр., невозможность дальнейшей загрузки или требование немедленного вмешательства 
для обеспечения целостности данных)

Каждый последующий уровень исключает сообщения от предыдущих уровней. Например, 
если установлен уровень **info**, то отладочные сообщения с уровня **debug** 
не генерируются, а уровень **error** блокирует все сообщения, кроме сообщений
об ошибках.

Таким образом, уровни логирования предназначены для отсечения незначительных 
сообщений, но не подавляют более важные.

Минимальный набор уровней включает:
1. **debug** - подробная отладочная информация, раскрывающая детали события
3. **warning** - ситуации, тебующие внимания, но не являющиеся ошибками
4. **error** - ошибки, влияющие на бизнес-процесс (напр., отсутствие сертификата)


## Настройки логирования

Основной настройкой логирования является выбор уровня. 
Настройка должна выглядеть единообразно для всех компонентов SafeMobile 
и обеспечивать интуитивно понятное заполнение. 

Пример для MDM-сервера.
Eдинственный параметр `log` для выбора уровня.
```angular2html
iosmdm.yml
    ...
#   установите уровень логирования, раскомментируйте нужное
    log debug       #  рекомендуемый уровень
#   log info
#   log warning
#   log error
#   log fatal
    ...
```
Для более тонкой настройки логирования (например, помодульной) разработчик может 
предусмотреть дополнительные параметры, выставлять и управлять которыми будет 
он сам, и которые опишет в документах по реализации.

## Применение без перезапуска
Компонент должен обеспечивать способ изменения уровня логирования "на ходу", без
своего перезапуска. 

Например, для изменения уровня логирования MDM-сервера без перезагрузки, в нём может 
быть предусмотрено соответствующее api. Это может понадобиться для того, чтобы 
переключить режим логирования удаленно.
